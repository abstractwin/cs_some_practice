# Использование Docker в качестве средства виртуализации.
﻿
Docker - программное обеспечение для автоматизации развёртывания и управления приложениями в средах с поддержкой контейнеризации. Позволяет «упаковать» приложение со всем его окружением и зависимостями в контейнер, который может быть перенесён на любую Linux-систему с поддержкой cgroups в ядре, а также предоставляет среду по управлению контейнерами. Изначально использовал возможности LXC, с 2015 года применял собственную библиотеку, абстрагирующую виртуализационные возможности ядра Linux - libcontainer. С появлением Open Container Initiative начался переход от монолитной к модульной архитектуре. [wiki](https://ru.wikipedia.org/wiki/Docker)

Docker является относительно новым и быстро развивающимся проектом, который позволяет создавать очень легкие «виртуальные машины». То что Docker позволяет создавать, в действительности не является виртуальной машиной. Docker решает многие из тех же проблем, что решают виртуальные машины, плюс некоторые другие, которые виртуальные машины могли бы решить в случае, если бы они не потребляли так много ресурсов. Docker можно использовать для следующего:
* изоляции зависимостей приложения;
* создания образа приложения и его тиражирования;
* создания готового для запуска приложения, которое легко распространять;
* возможности легкого и быстрого масштабирования отдельных экземпляров приложения;
* тестирования приложения и освобождения затраченных ресурсов после завершения тестирования.

Идея, стоящая за Docker, представляет собой создание переносимых легких контейнеров, применяемых для программ, которые могут быть запущены на любом компьютере с установленным Docker, причем, независимо от основной ОС, что напоминает грузовые контейнеры, используемые на суднах. Довольно амбициозно и успешно.

Двумя наиболее важными сущностями в Docker являются образы (images) и контейнеры (containers). 


## Образы

Образ в Docker похож на снимок виртуальной машины, но он более легковесен.

Есть несколько способов создания образов в Docker, большинство из них основывается на создании нового образа на базе уже существующего образа, и поскольку есть общедоступные образы почти для всего, что вам может потребоваться, в том числе для основных дистрибутивов Linux, поэтому маловероятно, что вы не найдете то, что вам нужно. Однако, если вы посчитаете, что нужно создать образ с нуля, то это можно сделать несколькими способами.

Чтобы создать образ, вы берете некоторый образ и изменяете его таким образом, чтобы получился образ-потомок. Это можно сделать либо с помощью файла, в котором определяется базовый образ и изменения, которые должны быть выполнены, либо в живую "запускаете" образ, изменяете его и сохраняете в нем изменения. У каждого способа есть свои преимущества, но обычно для внесения изменений предпочитают использовать файл.

У образов есть уникальный идентификатор и уникальная пара параметров - уникальное удобочитаемое название и тег. Образы могут назваться, например, ubuntu:latest, ubuntu:precise, django:1.6, django:1.7 и т.д. [rus-linux](rus-linux.net/MyLDP/vm/docker/docker-tutorial.html)

Для управления образами используется команды **docker image ...**, доступные для образов команды:
* **build** - собирает образ из Dockerfile;
* **history** - отображает историю образа;
* **import** - импортировать содержимое из архива, чтобы создать образ файловой системы;
* **inspect** - возвращает информацию низкого уровня о одного или нескольких образов;
* **load** - загрузить образ из архива или STDIN;
* **ls** - отображает список образов;
* **prune** - удаляет неиспользуемые образы;
* **pull** - загрузить (pull) образ или репозиторий из реестра Docker registry;
* **push** - выгрузить (push) образ или репозиторий в реестр Docker;
* **rm** - удаляет один или несколько образов;
* **save** - сохраняет образ в архив;
* **tag** - указать тег для образа. [dker](https://dker.ru/docs/docker-engine/engine-reference/command-line-reference/docker-commands/)



## Контейнеры

Вы можете из образов создавать контейнеры, что эквивалентно созданию виртуальной машины из моментального снимка, но способ, с помощью которого это делается, менее ресурсоемкий. Контейнеры являются именно тем, что запускается и функционирует. [rus-linux](rus-linux.net/MyLDP/vm/docker/docker-tutorial.html)

Для управления контейнерами используется команды **docker container ...**, доступные для контейнеров команды:
* **attach** - подключиться к запущенному контейнеру;
* **commit** - cоздает новый образ из измененного контейнера;
* **cp** - копирует файлы/каталоги из контейнера в HOSTDIR или STDOUT;
* **create** - создает новый контейнер;
* **diff** - проверяет изменения в файловой системе контейнера;
* **exec** - выполняет команду в запущенном контейнере;
* **export** - экспортирует файловую систему контейнера в tar архив;
* **inspect** - возвращает информацию низкого уровня о контейнере;
* **kill** - грубое завершение запущенного контейнера;
* **logs** - отображает логи контейнера;
* **ls** - список контейнеров;
* **pause** - ставит на паузу все процессы контейнера;
* **port** - отображение общего списка портов или для конкретного контейнера;
* **prune** - удаляет неиспользуемые контейнеры;
* **rename** - переименовать контейнер;
* **restart** - перезапускает запущенный контейнер;
* **rm** - удаляет один или несколько контейнеров;
* **run** - выполняет команду в новом контейнере;
* **start** - запускает один или несколько остановленных контейнеров;
* **stats** - выводит в реальном времени информацию о потребляемых контейнером ресурсах;
* **stop** - останавливает контейнер;
* **top** - отображает запущенные в контейнере процессы;
* **unpause** - снимает с паузы все процессы контейнера;
* **update** - обновляет конфигурацию одного или нескольких контейнеров;
* **wait** - блокирует контейнер до его остановки, а затем выводит код завершения. [dker](https://dker.ru/docs/docker-engine/engine-reference/command-line-reference/docker-commands/)


## Установка Docker

Вне зависимости от выбранной операционной системы для работы с docker изображениями и контейнерами следует использовать PowerShell на Windows и Terminal на Linux.


### Установка Docker Desktop на Windows

Согласно инструкции [docs.docker](docs.docker.com/docker-for-windows/install/)  Docker Desktop устанавливается следующим образом:

1. По адресу [docs.docker](docs.docker.com/docker-for-windows/install/) нажать на кнопку "Download from Docker Hub".
![Страница руководства по установки Docker Desktop на Windows](/data/docker_install_windows_0.png)

2. В результате чего мы будем перенаправленны на [id.docker.com/login/](id.docker.com/login/), где следует ввести логин и пароль для входа в систему.
![Страница авторизации в Docker Hub](/data/docker_install_windows_1.png)

3. Оказавшись на [hub.docker](hub.docker.com/), осуществляется скачивание "Docker for Window installer.exe" посредством выбора сооствествующей кнопки загрузки.
![Страница Docker Hub, на которой предлагается сказать Docker Desktop](/data/docker_install_windows_2.png)

4. Запустить установочных исполняемый файл.
![Изображение установочного файла "Docker for Window installer.exe"](/data/docker_install_windows_3.png)

5. Из предложенного: добавление ярлыка на рабочий стол; использование контейнеров Windows, вместо контейнеров Linux, - выбирается необходимое.
![Диалоговое окно инстолятора docker](/data/docker_install_windows_4.png)

6. После установки следует выйти из текущей рабочей сессии пользователя.
![Преложение выйти, следующее за завершением установки](/data/docker_install_windows_5.png)

7. После входа в систему, docker предложит активизировать функции Hyper-V и Containers (для этого потребуется перезагрузка компьютера).
![Сообщение предлагающее активизировать дополнительные функции](/data/docker_install_windows_6.png)

8. После перезагрузки docker будет запущен в фоновом режиме, и доступен в области уведомлений.
![Docker в области уведомлений](/data/docker_install_windows_7.png)

9. Для открытия свойств docker следует: выбрать плитку программы в области уведомлений, нажать правой кнопкой мыши, и выбрать пункт "Settings".
![Окно настроек docker](/data/docker_install_windows_8.png)

### Установка Docker на Ubuntu

Для установки Docker на Ubuntu, в терминале достаточно выполнить следующую комманду:
'''bash
sudo apt install docker docker.io
'''

Для запуска команды docker без использования sudo, требуется добавить пользователя (обладающего правами root) в группу docker. Для этого следует выполнить следующую комманду:
'''
sudo usermod -aG docker USER_NAME
'''
